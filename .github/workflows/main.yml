name: Deploy EF Azure Database
on:
  workflow_call:
    inputs:
      username:
        description: 'Username passed from the caller workflow'
        default: 'jv ravichandran'
        required: false
        type: string
  workflow_run:
    workflows: ["Deploy"]
    types: [requested]
    branches:
      - 'develop/**'
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]
jobs:
  print-username:
    name: Print username
    runs-on: ubuntu
    steps:
    - name: Print the USER name to STDOUT
      run: echo The username is ${{ inputs.username }}
  Deploy:
    name: Check out repo
    runs-on: ubuntu
    steps:
    - name: Check out repo
      uses: actions/checkout@v2
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1.4.0
      with:
        dotnet-version: '3.1.100' 
    - name: Restore dependencies 
      working-directory: deploy-db
      run: dotnet restore      
    - name: Deploy
      working-directory: deploy-db
      run: dotnet run
