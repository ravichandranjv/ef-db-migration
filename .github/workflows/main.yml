name: Deploy EF Azure Database
on:
  workflow_call:
    inputs:
      username:
        description: 'Username passed from the caller workflow'
        default: 'jv ravichandran'
        required: false
        type: string
  push:
    branches: [ develop ]
jobs:
  print-username:
    name: Print username
    runs-on: ubuntu-latest
    steps:
    - name: Print the USER name to STDOUT
      run: echo The username is ${{ inputs.username }} and connection string is ${{ secrets.AZURE_SQL_CONNECTION_STRING }}
  Build:
    name: Build sql action
    runs-on: ubuntu-latest
    steps:
    - name: Check out repo
      uses: actions/checkout@v3
    - name: Azure SQL Deploy
      uses: azure/sql-action@v2
      with:        
        connection-string: ${{ secrets.AZURE_SQL_CONNECTION_STRING }}
        path: './Database.sqlproj'
        action: 'publish'